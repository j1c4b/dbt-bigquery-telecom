version: 2

sources:
  - name: raw_telecom
    description: |
      **PHASE 1 VALIDATION SOURCE**
      Raw telecom operational data from source systems.
      Focus on basic structure validation and relationships.
    
    database: dbt-bigquery-telecom
    schema: telecom_raw_data
    
    tables:
      # =============================================
      # CUSTOMERS TABLE - Master customer data
      # =============================================
      - name: customers
        description: "Customer master data - foundation for all relationships"
        columns:
          - name: customer_id
            description: "Primary key - unique customer identifier"
            tests:
              - unique
              - not_null
                  
          - name: email
            description: "Customer email - unique identifier for communication"
            tests:
              - unique
              - not_null
                    
          - name: phone_number
            description: "Primary contact number"
            tests:
              - not_null
                    
          - name: registration_date
            description: "Customer registration date"
            tests:
              - not_null
                    
          - name: customer_status
            description: "Current customer status"
            tests:
              - not_null
              - accepted_values:
                  arguments:
                    values: ['Active', 'Inactive', 'Churned', 'Unknown']
                    
          - name: updated_at
            description: "Record last update timestamp"
            tests:
              - not_null

      # =============================================
      # SUBSCRIPTIONS TABLE
      # =============================================
      - name: subscriptions
        description: "Customer subscription data"
        columns:
          - name: subscription_id
            description: "Primary key for subscription"
            tests:
              - unique
              - not_null
                    
          - name: customer_id
            description: "Foreign key to customers table"
            tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('raw_telecom', 'customers')
                    field: customer_id
                    
          - name: plan_id
            description: "Plan identifier"
            tests:
              - not_null
                    
          - name: start_date
            description: "Subscription start date"
            tests:
              - not_null
                    
          - name: monthly_fee
            description: "Monthly subscription fee"
            tests:
              - not_null

      # =============================================
      # USAGE_RECORDS TABLE
      # =============================================
      - name: usage_records
        description: "Daily usage records - high volume table"
        columns:
          - name: usage_id
            description: "Unique usage record identifier"
            tests:
              - unique
              - not_null
                    
          - name: customer_id
            description: "Customer identifier - must exist in customers"
            tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('raw_telecom', 'customers')
                    field: customer_id
                    
          - name: usage_date
            description: "Date of usage"
            tests:
              - not_null

      # =============================================
      # BILLING TABLE
      # =============================================
      - name: billing
        description: "Monthly billing records"
        columns:
          - name: bill_id
            description: "Unique billing record identifier"
            tests:
              - unique
              - not_null
                    
          - name: customer_id
            description: "Customer being billed"
            tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('raw_telecom', 'customers')
                    field: customer_id
                    
          - name: total_amount
            description: "Total bill amount"
            tests:
              - not_null

      # =============================================
      # NETWORK_QUALITY TABLE
      # =============================================
      - name: network_quality
        description: "Network performance data"
        columns:
          - name: quality_id
            description: "Unique quality record identifier"
            tests:
              - unique
              - not_null
                    
          - name: customer_id
            description: "Customer identifier"
            tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('raw_telecom', 'customers')
                    field: customer_id
                    
          - name: call_quality_score
            description: "Call quality score (1-5 scale)"
            tests:
              - not_null